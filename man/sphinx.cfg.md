% sphinx.cfg(7) | configuration for the SPHINX password manager

# DESCRIPTION

# CONFIGURATION FILES

Both the client and the server can be configured by any of the
following files:

 - `/etc/sphinx/config`
 - `~/.sphinxrc`
 - `~/.config/sphinx/config`
 - `./sphinx.cfg`

Files are parsed in this order, this means global settings can be
overridden by per-user and per-directory settings.

# CLIENT CONFIGURATION

The client can be configured changing the settings in the `[client]`
section of the config file. The `host` and `port` should match what
you set in the `oracle(1)` server.

The `datadir` (default: `~/.sphinx`) variable holds the location for
your client parameters. Particularly it contains a masterkey which is
used to derive secrets. The master key - if not available - is
generated by issuing an `init` command. You **should** back up and
encrypt this master key.

`rwd_keys` toggles if the master password is required for
authentication of management operations.

The oracle is oblivious to this setting, this is purely a client-side
toggle, in theory it is possible to have different settings for
different "records" on the oracle.

`validate_password` Stores a check digit of 5 bits in on the oracle,
this helps to notice most typos of the master password, while
decreasing security slightly.

# SERVER CONFIGURATION

The server can be configured by changing the variables in the
`[server]` section of the config file.

The `address` is the IP address on which the server is listening,
default is `localhost` - you might want to change that.

The `port` where the server is listening is by default 2355. Another
recommended values is to use port 433 which is allowed by most
firewalls while 2355 is not.

`datadir` specifies the data directory where all the device "secrets"
are stored, this defaults to "data/" in the current directory. You
might want to back up this directory from time to time to an encrypted
medium.

`verbose` enables logging to standard output.

`timeout` sets the timeout for any connection the server keeps open.

`max_kids` sets the number maximum requests handled in parallel. The
`timeout` config variable makes sure that all handlers are recycled in
predictable time.

`rl_decay` specifies the number of seconds after which a ratelimit level
decays to an easier difficulty.

`rl_threshold` increase the difficulty of ratelimit puzzles if not
decaying.

`rl_gracetime` gracetime in seconds added to the expcted time to solve
a rate-limiting puzzle.

# WEBSPHINX CONFIGURATION

The native backend for the Firefox and Chrome addons also has a
configuration section. In the `[websphinx]` section you can specify
which pinentry variant to use for querying passwords.

# SECURITY CONSIDERATIONS

The server configuration values `max_kids` and `timeout` can be used
to tune how many requests are served in parallel and how long each
request is allowed to take before it gets killed. An attacker might be
able to run a denial-of-service attack against your server, by keeping
all `max_kids` connections "occupied".

Since the server does only know about failed authorizations for
management operations, but not about correctness of master passwords
for get requests, there is no way to mitigate master password
bruteforce attempts aside from ratelimiting. By tuning the
configuration variables starting with `rl_` it is possible to
configure this. If you have clients that have less than 1G RAM, it
might be possible to increase the difficulty to the maximum level
where those devices will not be able to solve the ratelimting
puzzles. Rate-limiting in general should not be noticable, only if
dozens of get requests are served to the same record. At the highest
level the solution should take about 20-40 seconds (depending on your
cpu).

The `rwd_keys` client configuration setting, if set to False protects
against offline master password bruteforce attacks - which is also a
security guarantee of the original SPHINX protocol.

The drawback is that for known (host,username) pairs the according
record can be changed/deleted by an attacker if the clients masterkey
is available to them. However neither the master nor the account
password can leak this way. This is merely a denial-of-service attack
vector. If `rwd_keys` is set to True, then this eliminates the
denial-of-service vector, but also negates the offline-bruteforce
guarantee of the SPHINX protocol. This setting is really a compromise
between availability of account passwords versus the confidentiality
of your master password.

The `validate_password` client configuration setting if enabled,
decreases security slightly (by 5 bits). In general it should be safe
to enable.

# EXAMPLE CLIENT CONFIG

```
[client]
# whether to produce some output on the console
#verbose = False

# the ip address or hostname the server is listening on
#address = 127.0.0.1

# the port on which the server is listening
#port = 2355

# the directory where the client stores its master secret - you might want to
# back this up
#datadir = ~/.config/sphinx

# master password optional for authentication, if it is False it protects
# against offline master pwd bruteforce attacks. The drawback is that for known
# (host,username) tuples the seeds/blobs can be changed/deleted by an attacker
# if the client masterkey is known
#rwd_keys=False

# stores a check digit of 5 bits in the rule blob, this helps to notice most
# typos of the master password, while decreasing security slightly
#validate_password=True

```

# EXAMPLE SERVER CONFIG

```
[server]
# the ipv4 address the server is listening on
#address="127.0.0.1"

# the port on which the server is listening, use 443 if available, so that
# the oracle can be accessed from behind tight firewalls
#port=2355

# ssl key - no default must be specified
ssl_key="server.der"

# ssl cert - no default must be specified
ssl_cert="cert.pem"

# tcp connection timeouts, increase in case you have bad networks, with the
# caveat that this might lead to easier resource exhaustion - blocking all
# workers.
#timeout=3

# how many worker processes can run in parallel
# max_kids=5

# the root directory where all data is stored
#datadir= "/var/lib/sphinx"

# whether to produce some output on the console
#verbose=false

# decay ratelimit after rl_decay seconds
#rl_decay= 1800

# increase hardness after rl_threshold attempts if not decaying
#rl_threshold= 1

# when checking freshness of puzzle solution, allow this extra
# gracetime in addition to the hardness max solution time
#rl_gracetime=10
```

# EXAMPLE WEBSPHINX CONFIGURATION

```
[websphinx]
# the path of your pinentry program
pinentry=/usr/bin/pinentry

# a file where websphinx logs, this is only for dev/debug purposes
log=
```

# REPORTING BUGS

https://github.com/stef/pwdsphinx/issues/

# AUTHOR

Written by Stefan Marsiske.

## COPYRIGHT

Copyright Â© 2023 Stefan Marsiske.  License GPLv3+: GNU GPL version 3 or later <https://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it.  There is NO WARRANTY, to the extent permitted by law.

## SEE ALSO

`sphinx(1)`, `oracle(1)`
